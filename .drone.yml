---
kind: pipeline
name: default

clone:

steps:
  - name: composer
    image: joomlaprojects/docker-images:php7.4
    volumes:
      - name: composer-cache
        path: /tmp/composer-cache
    commands:
      - composer validate --no-check-all --strict
      - composer install --no-progress --no-suggest

  - name: npm
    image: node:16-alpine
    commands:
      - npm ci --unsafe-perm

  - name: deployment
    image: appleboy/drone-ssh
    settings:
      host:
        from_secret: help_host
      username:
        from_secret: help_username
      port: 22
      key:
        from_secret: help_key
      script:
        - cd /home/help/website
        - bin/console update:server
    when:
      branch:
        - master
      event:
        - push

volumes:
  - name: composer-cache
    host:
      path: /tmp/composer-cache
---
kind: signature
hmac: 7d374a33e65281a51555bd1423dca6cf809a0142a7cf26f3185f4564820a9b98

...
